DROP TABLE Photographers CASCADE;
DROP TABLE Photographs CASCADE;
DROP TABLE PhotoSales CASCADE;
DROP TABLE Customers CASCADE;
DROP TABLE RefPhotoAttributes CASCADE;
DROP TABLE PhotoAttributes CASCADE;
DROP TABLE RefSalesCategory CASCADE;
DROP TABLE SalesCategories CASCADE;
DROP TABLE RefEquipmentUsed CASCADE;
DROP TABLE PhotoEquipment CASCADE;
DROP TABLE UpdatedPhotographs CASCADE;

CREATE TABLE Photographers
(id_photographer SERIAL,
 first_name CHAR (20),
 last_name CHAR (20),
 order_form CHAR (30),
 PRIMARY KEY (id_photographer)
);
CREATE UNIQUE INDEX name_index on Photographers(last_name, first_name);

CREATE TABLE Photographs
(
 id_photo SERIAL,
 filename char(20),
 title char(20),
 Description char(20),
 id_photographer int,
 photo_order int,
 height int, 
 width int,
 city char (20),
 state char (20),
 country char(20),
 date_taken date,
 PRIMARY KEY (id_photo),
 FOREIGN KEY (id_photographer) REFERENCES Photographers(id_photographer) ON DELETE CASCADE
);
CREATE UNIQUE INDEX filename_index on Photographs (filename); 

CREATE TABLE Customers
(
id_customer SERIAL,
first_name char(20),
last_name char(20),
address1 char(50),
address2 char(50),
city char(20),
state char(20),
zip char(9),
country char(20),
PRIMARY KEY (id_customer)
);
CREATE UNIQUE INDEX customer_name_index on Customers (last_name, first_name);
CREATE TABLE PhotoSales
(
 id_sale SERIAL,
id_customer int,
 id_photo int,
quanity_sold int,
 id_sale_price float,
 id_tax float,
 sale_date date,
 PRIMARY KEY (id_sale)
);

CREATE TABLE RefPhotoAttributes
(
 id_attribute SERIAL,
 attribute_desc char(20),
 PRIMARY KEY (id_attribute)
);

CREATE UNIQUE INDEX attribute_index on RefPhotoAttributes (attribute_desc);

CREATE TABLE PhotoAttributes
(
 id_photo int,
 id_attribute int,
 PRIMARY KEY (id_photo, id_attribute),
 FOREIGN KEY (id_photo) REFERENCES Photographs(id_photo) ON DELETE CASCADE,
 FOREIGN KEY (id_attribute) REFERENCES RefPhotoAttributes(id_attribute) ON DELETE CASCADE
);


CREATE TABLE RefSalesCategory
(
 id_sales_category int,
 sales_category char(20),
 PRIMARY KEY (id_sales_category)
);

CREATE UNIQUE INDEX salescat_index on RefSalesCategory (sales_category);

CREATE TABLE SalesCategories
(
 id_photo int,
 id_sales_category int,
 PRIMARY KEY (id_photo, id_sales_category),
 FOREIGN KEY (id_photo) REFERENCES Photographs(id_photo) ON DELETE CASCADE,
 FOREIGN KEY (id_sales_category) REFERENCES RefSalesCategory(id_sales_category) ON DELETE CASCADE
);
 

CREATE TABLE RefEquipmentUsed
( 
 id_equipment SERIAL,
 equipment_desc char(30),
 PRIMARY KEY (id_equipment));

CREATE TABLE PhotoEquipment
(
 id_photo int,
 id_equipment int,
 PRIMARY KEY (id_photo, id_equipment),
 FOREIGN KEY (id_photo) REFERENCES Photographs(id_photo) ON DELETE CASCADE,
 FOREIGN KEY (id_equipment) REFERENCES RefEquipmentUsed(id_equipment) ON DELETE CASCADE
);

CREATE TABLE UpdatedPhotographs
(
 filename char(20),
 title char(20),
 PRIMARY KEY (filename)
);


COPY Photographers FROM './Database_Tables/Photographers.csv' DELIMITER ',' CSV HEADER TRUE;
COPY Photographs FROM './Database_Tables/Photographs.csv' DELIMITER ',' CSV HEADER TRUE;
COPY PhotoSales FROM './Database_Tables/PhotoSales.csv' DELIMITER ',' CSV HEADER TRUE;
COPY Customers FROM './Database_Tables/Customers.csv' DELIMITER ',' CSV HEADER TRUE;
COPY RefPhotoAttributes FROM './Database_Tables/RefPhotoAttributes.csv' DELIMITER ',' CSV HEADER TRUE;
COPY RefSalesCategory FROM './Database_Tables/RefSalesCategory.csv' DELIMITER ',' CSV HEADER TRUE;
COPY SalesCategories FROM './Database_Tables/SalesCategories.csv' DELIMITER ',' CSV HEADER TRUE;
COPY RefEquipmentUsed FROM './Database_Tables/RefEquipmentUsed.csv' DELIMITER ',' CSV HEADER TRUE;
COPY PhotoEquipment FROM './Database_Tables/PhotoEquipment.csv' DELIMITER ',' CSV HEADER TRUE;
COPY UpdatedPhotographs FROM './Database_Tables/UpdatedPhotographs.csv' DELIMITER ',' CSV HEADER TRUE;